WT_DECLARE_WT_MEMBER(1,"WSuggestionPopup",function(q,d,y,z,r){function m(a){return $(a).hasClass("Wt-suggest-onedit")||$(a).hasClass("Wt-suggest-dropdown")}function s(){return d.style.display!="none"}function k(){d.style.display="none"}function A(a){c.positionAtWidget(d.id,a.id,c.Vertical)}function B(a){a=a||window.event;a=a.target||a.srcElement;if(a.className!="content"){if(!c.hasTag(a,"DIV"))a=a.parentNode;t(a)}}function t(a){var b=a.firstChild,h=c.getElement(f),e=b.innerHTML;b=b.getAttribute("sug");
h.focus();q.emit(d,"select",a.id,h.id);y(h,e,b);k();f=null}function C(a,b){for(a=b?a.nextSibling:a.previousSibling;a;a=b?a.nextSibling:a.previousSibling)if(c.hasTag(a,"DIV"))if(a.style.display!="none")return a;return null}$(".Wt-domRoot").add(d);jQuery.data(d,"obj",this);var n=this,c=q.WT,l=null,f=null,u=false,v=null,w=null,o=null;this.showPopup=function(){d.style.display="";l=null};this.editMouseMove=function(a,b){if(m(a))a.style.cursor=c.widgetCoordinates(a,b).x>a.offsetWidth-16?"default":""};this.editClick=
function(a,b){if(m(a))if(c.widgetCoordinates(a,b).x>a.offsetWidth-16)if(f!=a.id){k();f=a.id;n.refilter()}else{f=null;k()}};this.editKeyDown=function(a,b){if(!m(a))return true;if(f!=a.id)if($(a).hasClass("Wt-suggest-onedit"))f=a.id;else if($(a).hasClass("Wt-suggest-dropdown")&&b.keyCode==40)f=a.id;else{f=null;return true}var h=l?c.getElement(l):null;if(s()&&h)if(b.keyCode==13||b.keyCode==9){t(h);c.cancelEvent(b);setTimeout(function(){a.focus()},0);return false}else if(b.keyCode==40||b.keyCode==38||
b.keyCode==34||b.keyCode==33){if(b.type.toUpperCase()=="KEYDOWN"){u=true;c.cancelEvent(b,c.CancelDefaultAction)}if(b.type.toUpperCase()=="KEYPRESS"&&u==true){c.cancelEvent(b);return false}var e=h,p=b.keyCode==40||b.keyCode==34;b=b.keyCode==34||b.keyCode==33?d.clientHeight/h.offsetHeight:1;var j;for(j=0;e&&j<b;++j){var g=C(e,p);if(!g)break;e=g}if(e&&c.hasTag(e,"DIV")){h.className="";e.className="sel";l=e.id}return false}return b.keyCode!=13&&b.keyCode!=9};this.filtered=function(a){v=a;n.refilter()};
this.refilter=function(){var a=l?c.getElement(l):null,b=c.getElement(f),h=z(b),e=!$(b).hasClass("Wt-suggest-dropdown"),p=d.lastChild.childNodes,j=h(null);if(r)if(e&&j.length<r){k();return}else{var g=j.substring(0,r);if(g!=v){if(g!=w){w=g;q.emit(d,"filter",g)}if(e){k();return}}}g=null;e=!e&&j.length==0;for(j=0;j<p.length;j++){var i=p[j];if(c.hasTag(i,"DIV")){if(i.orig==null)i.orig=i.firstChild.innerHTML;else i.firstChild.innerHTML=i.orig;var x=h(i.firstChild.innerHTML),D=e||x.match;i.firstChild.innerHTML=
x.suggestion;if(D){i.style.display="";if(g==null)g=i}else i.style.display="none";i.className=""}}if(g==null)k();else{if(!s()){A(b);n.showPopup();a=null}if(!a||a.style.display=="none"){l=g.id;a=g;a.parentNode.scrollTop=0}a.className="sel";b=a.parentNode;if(a.offsetTop+a.offsetHeight>b.scrollTop+b.clientHeight)b.scrollTop=a.offsetTop+a.offsetHeight-b.clientHeight;else if(a.offsetTop<b.scrollTop)b.scrollTop=a.offsetTop}};this.editKeyUp=function(a,b){if(f!=null)if(m(a))if(!((b.keyCode==13||b.keyCode==
9)&&d.style.display=="none"))if(b.keyCode==27||b.keyCode==37||b.keyCode==39){d.style.display="none";if(b.keyCode==27){f=null;$(a).hasClass("Wt-suggest-dropdown")?k():a.blur()}}else n.refilter()};d.lastChild.onclick=B;d.lastChild.onscroll=function(){if(o){clearTimeout(o);var a=c.getElement(f);a&&a.focus()}};this.delayHide=function(a){o=setTimeout(function(){o=null;if(d&&(a==null||f==a.id))k()},300)}});
